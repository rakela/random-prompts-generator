---
import { getCanonicalUrl, PRIMARY_DOMAIN, type SEOData } from '../data/seo';
import '@/styles/global.css';

interface Props {
  seo: SEOData;
}

const { seo } = Astro.props;
const canonicalUrl = getCanonicalUrl(seo.path);
const ogImage = seo.ogImage || `${PRIMARY_DOMAIN.startsWith('http') ? PRIMARY_DOMAIN : `https://${PRIMARY_DOMAIN}`}/og-image.png`;

// Check if on primary domain (for robots meta)
const currentDomain = Astro.url.hostname;
const isPrimaryDomain = currentDomain === PRIMARY_DOMAIN || currentDomain === `www.${PRIMARY_DOMAIN}`;
const robotsMeta = isPrimaryDomain ? 'index, follow' : 'noindex, nofollow';
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/svg+xml" href="/logo.svg" />

  <!-- Basic SEO -->
  <title>{seo.title}</title>
  <meta name="description" content={seo.description} />
  <meta name="keywords" content={seo.keywords} />
  <meta name="robots" content={robotsMeta} id="robots-meta" />
  <meta name="theme-color" content="#3B82F6" />

  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalUrl} />

  <!-- Open Graph Tags -->
  <meta property="og:site_name" content="Random Prompts Generator" />
  <meta property="og:title" content={seo.title} />
  <meta property="og:description" content={seo.description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:image:secure_url" content={ogImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content="Random Prompts Generator - Free tool for writing, AI art, blogs & fantasy" />
  <meta property="og:locale" content="en_US" />

  <!-- Twitter Card Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={seo.title} />
  <meta name="twitter:description" content={seo.description} />
  <meta name="twitter:image" content={ogImage} />
  <meta name="twitter:image:alt" content="Random Prompts Generator - Free tool for writing, AI art, blogs & fantasy" />

  <!-- JSON-LD: WebApplication -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Random Prompts Generator",
    "url": "https://randomprompts.org/",
    "applicationCategory": "CreativeApplication",
    "operatingSystem": "Web",
    "description": "Generate prompts for writing, AI art, blogs, and fantasy worldbuilding.",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "publisher": { "@type": "Organization", "name": "RandomPrompts.org", "url": "https://randomprompts.org" }
  })} />

  <!-- JSON-LD: FAQPage -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is a random prompts generator?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It's a tool that instantly creates unique ideas for writing, AI art, blogs, and worldbuilding using curated templates and parameters like genre, tone, and style."
        }
      },
      {
        "@type": "Question",
        "name": "Is the Random Prompts Generator free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. You can generate unlimited prompts for free. Optional pro features may include saving, bulk export, and an API."
        }
      },
      {
        "@type": "Question",
        "name": "Can I use the generated prompts commercially?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. Prompts are yours to use for personal or commercial projects; attribution is appreciated but not required."
        }
      }
    ]
  })} />

  <!-- Domain Verification Script -->
  <script is:inline>
    (function() {
      const PRIMARY_DOMAIN = 'randomprompts.org';
      const currentDomain = window.location.hostname;
      const isPrimary = currentDomain === PRIMARY_DOMAIN || currentDomain === 'www.' + PRIMARY_DOMAIN;

      if (!isPrimary) {
        const robotsMeta = document.getElementById('robots-meta');
        if (robotsMeta) {
          robotsMeta.setAttribute('content', 'noindex, nofollow');
        }
        console.warn('⚠️ Non-primary domain detected. Pages set to noindex,nofollow');
      }
    })();
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RSS9MM86H4" is:inline></script>
  <script is:inline>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-RSS9MM86H4');
  </script>

  <!-- Clarity tracking code -->
  <script is:inline>
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "tyqdxn2s1m");
  </script>
</head>
<body class="bg-white text-gray-900">
  <slot />
</body>
</html>
